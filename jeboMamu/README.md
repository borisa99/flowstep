![Flowstep](https://user-images.githubusercontent.com/30647992/170829743-88fce42d-8e5e-4fc5-8745-dce77fceb216.png)

## Description

`Flowstep` is an app for sharing screencasts and screenshots for different kind of mobile applications (banking, e-commerce, etc.). Screencasts and screenshots are organized in flows. Users can upload their own flows and make private collections of other flows. Flows can be liked, shared or saved to private collection. Most often, flows are part of already existing app, so App Store link is also provided within app page.
 
The application is written using [Next.js](https://nextjs.org/) with [Typescript](https://www.typescriptlang.org/). 

## How to run

The data is retrieved and manipulated using GraphQL, which is handled by [NodeJS](https://nodejs.org/en/docs/) & [Hasura](https://hasura.io/docs/latest/graphql/core/index/) application. 

Hasura GraphQL and REST APIs endpoints, along with admin secret for access, should be defined through enviroment variables defined in file `.env.local`.

### Run the app 

```
git clone https://github.com/crewnew/flowstep-frontend.git
cd flowstep-frontend
cp .env.example .env.local
'Configure the enviroment variables in .env file'
npm install
npm run dev
```
#### Enviroment variables
 
```
NEXT_PUBLIC_GRAPHQL_ENDPOINT=https://api.flowstep.co/v1/graphql  
GRAPHQL_ADMIN_SECRET=
NEXT_PUBLIC_REST_ENDPOINT=https://api.flowstep.co/
NEXT_PUBLIC_GOOGLE_CLIENT_ID=
```

### Other commands

```
npm run build - runs next build and builds the project
npm run start - runs built version of project
npm run codegen - runs graphql-codegen based on configuration from codegen.yml
```

### Recomended VS Code Plugins
- Name: Prettier - Code formatter
VS Marketplace Link: https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode
- Tailwind CSS IntelliSense
VS Marketplace Link: https://marketplace.visualstudio.com/items?itemName=bradlc.vscode-tailwindcss

Prettier and ESLint are confiugred out of the box for VS Code Usage


|   Name         | Description | Url |
| -------------- | ----------- | --- |
| Reduxt Toolkit | The official, opinionated, batteries-included toolset for efficient Redux development - State Mangment | https://redux-toolkit.js.org/ |
| Apollo Client | The industry-standard open-source GraphQL _client_|https://www.apollographql.com/docs/ |
|Tailwind CSS| A utility-first CSS framework packed| https://tailwindcss.com/docs/guides/nextjs |
| GraphQL Codegen | Generate _code_ from your _GraphQL_ schema and _GraphQL_ operations with a single function call regardless of your environment or _code_ format | https://www.graphql-code-generator.com/|

**BEFORE MAKING ANY CHANGES TO THE CODEBASE MAKE SURE YOU ARE FAMILIAR WITH THE LISTED PLUGINS, LIBRARIES AS WELL AS NEXT.JS ITSELF.**


## Folder Structue 
1. **~** - root
     - **/ .vscode** -- Visual Studio Code configuration that will be same for all developers
     - **/ public** -- Publicly accessable files such as favicon.ico
     - **/ src**
		  - **/ assets/images/svg** - app images in SVG format 
		  - **/ pages** - [Next.js pages directory](https://nextjs.org/docs/basic-features/pages)
		  - **/ components** - regular React components
			-  **/ elements** - basic components used for all other components
			-  **/ `component-name`** - folder with component files (code & types)
				- **/ `subcomponent-name`** - if component is complex, each minor component has its own folder
			- **/ types** - common types used across different components
		  - **/ layouts** - bacis and specific layouts for app splitted by feature (read *Layouts* section for more info)  
		  - **/ types** - app custom types  
		  - **/ styles** - global CSS files and [Ico Moon](https://icomoon.io/#docs) icons package  
		  - **/ graphql** - Graphql queries, mutations and fragments as well as codegen configuration. After codegen has been run new file will be created called `generated.jsx`, from it you can import hooks and hoc-s that are created based on your queries and mutations. Ex. `useServersideUsers`. Also all of the filtering , input and comparison objects for GraphQL schema are generated by default.
		  	- **codegen.yml** - settings for GraphQL Codegen
			- **/ documents** - GraphQL queries and mutations - when you are  adding lets say new query for users you need to create directory inside called **/users** and inside of it make the query that folowing practice ``*.{query,mutation}.graphql``. Ex. `/src/graphql/users/all.query.graphql` will be recognised by codegen as valid.
			- **/ fragments** - GraphQL fragments - they need to follow this naming practice `*.fragment.graphql`. Ex. `user.fragment.graphql`
		  - **/ redux**
		  	- **store.ts** - redux store configuration
		  	- **hooks.ts** - typed instances of regular redux hooks. Ex. `useSelector` and `useSelector`
		  	- **/ slices** - redux slices splitted by feature
			    - **/ `feature-name`** - feature related slices
		  - **/ hooks** - custom made [React hooks](https://reactjs.org/docs/hooks-custom.html)
		  	- **/ use-`functionality`** - each hook has its own folder
		  - **/ utils** - utilities and constant files

## Custom Hooks

There are several hooks for often actions - authentication, form management, click outside element, etc.

### use-auth
Used for user authentication actions and data. This hook provides user's currrent email (if user is logged in), login, setters for password and email that will manipulate app's state.

### use-call-to-action
Hook that controls a flow of an action. Input arguments are *action* and *calbacks (optional)*. 
*action* is a `Promise` and represents executable action in focus.
*callbacks* is an object that has optional functions within it: *onSuccessCallback, onAfterSuccessCallback, onErrorCallback*. All mentioned function can have arguments, but they do not have return value (`void`).
Hook provides *execute* method, along with properties describing execution state of the action - *isLoading, success, result, error*. 
When *execute* method is called and successfully executed, *onSuccessCallback* is the next step and after 1s delay *onAfterSuccessCallback* is the next one.

### use-click-outside
Used for handling events when users click outside specified element. Input arguments are *ref* and *onClickOutside*.
*ref* is a reference to element in focus. 
*onClickOutside* is a function that will be executed on click outside the referenced element.

### use-flow
Used for handling upload of flow, new or edited existing flow. There is no input arguments, because flow data is stored in app state. Hook provides *object* (new/edited flow), *createEditFlow* method for triggering the upload of flow and *createEditLoading* that indicates loading state of *createEditFlow* method.

### use-upload
Hook that handles uploading of a single file through REST endpoint for upload. Hook provides *isLoading, url, error* variables that describes state of upload itself and *upload* method for triggering upload of file, forwarded as an argument of this method.

### use-upload-multiple
Hook that handles process of uploading multiple files dropped. Input argument is *isVideo*, because upload is slightly different in case of video. Hook provides variables *droppedFiles, currentFile, percentage, uploadedFiles* and methods *queue, upload, removeFile*.

### use-form-fields
Hook that handles form validation and submiting process. Input arguments are *initalValues, validationRules* for form fields and *callback*, function or `Promise` that is called after successful submition of form. There is also *resetAfterSubmit* argument, which controls should reset of form is needed afted the submit.

### use-check-oveflow
Hook that calculates does element oveflow based on container dimensions. Used on app page lsit view.

## Layouts

Concept of layouts is introduced based on [Next.js Layouts with Typescript](https://nextjs.org/docs/basic-features/layouts#with-typescript). Beside *getLayout* method, *activeLayout* attribute is added.
Within *layouts* folder, there are several layouts - each has its own folder. When new layout is created, it should be added to layout types defined in *layouts/index.ts*. 

Layout is added to page by setting *activeLayout* property. If layout is not set for page, *Base* layout will be used by default.
Example: For Home page setting layout looks like `Home.activeLayout = 'Base'`

Initialization of page is managed with customized `App` component (*pages/_app.tsx*), which is an advanced feature of `Next.js`([Custom \`App\`](https://nextjs.org/docs/advanced-features/custom-app)).
That component also has *getLayout* method where loading spinner or page itself is wrapped in layout defined by *activeLayout* of the page or the default one.

## Queries & Mutations 

As mentioned above, all queries are defined in *graphql/documents* grouped in folders by feature or page. 

Adding a query or mutation means creating new folder if needed and new graphql file with one query or mutation. 

Naming convention for that file is <*OperationName*>.<*OperationType*>.graphql ([GraphQL Queries and Mutations - Operation name](https://graphql.org/learn/queries/#operation-name))
Example: Query for fetching flow by id will be in file named `flowById.query.graphql`

For fragments used in queries, naming convention is similar - instead of *OperationType*, fragment is used.

After adding query/fragment files, `codegen.yml` should be run, so necessary code for executing new queries/fragments is generated. Result of code generation are in file *graphql/generated.tsx*. It's important to follow the naming convention for queries and mutations, otherwise code generation will fail (name not recognized by codegen).


# flowstep
